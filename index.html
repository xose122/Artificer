<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Artificer - Human Battle Smith</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    <style>
        :root {
            --parchment: #f4ece1;
            --parchment-dark: #e8dcc8;
            --ink: #2a1f1a;
            --ink-light: #4a3f3a;
            --gold: #c9a227;
            --gold-dark: #8b6914;
            --copper: #b87333;
            --copper-dark: #8a5522;
            --copper-light: #d4956a;
            --steel: #4a5568;
            --steel-light: #636e80;
            --ruby: #8b2942;
            --border-ornate: #6b5344;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Crimson Text', Georgia, serif;
            background: 
                radial-gradient(ellipse at 20% 20%, rgba(184, 115, 51, 0.10) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(74, 85, 104, 0.08) 0%, transparent 50%),
                linear-gradient(180deg, #e8dcc8 0%, #f4ece1 50%, #e8dcc8 100%);
            min-height: 100vh; color: var(--ink); padding: 20px;
        }
        .spell-overlay { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(74,85,104,0.8); z-index:1000; justify-content:center; align-items:center; padding:20px; backdrop-filter:blur(3px); }
        .spell-overlay.active { display:flex; }
        .spell-popup { background: url("data:image/svg+xml,%3Csvg viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.03'/%3E%3C/svg%3E"), var(--parchment); border:3px solid var(--copper); border-radius:8px; max-width:500px; width:100%; max-height:80vh; overflow-y:auto; box-shadow:0 0 0 1px var(--steel),0 10px 40px rgba(0,0,0,0.5); animation:popupIn 0.2s ease-out; }
        @keyframes popupIn { from{opacity:0;transform:scale(0.95) translateY(-10px)} to{opacity:1;transform:scale(1) translateY(0)} }
        .spell-popup-header { background:linear-gradient(135deg,var(--steel) 0%,var(--steel-light) 100%); padding:15px 20px; border-bottom:2px solid var(--copper); position:relative; }
        .spell-popup-header.cantrip { background:linear-gradient(135deg,var(--ink-light) 0%,#5a4f4a 100%); }
        .spell-popup-header.subclass { background:linear-gradient(135deg,var(--copper-dark) 0%,var(--copper) 100%); }
        .spell-popup-title { font-family:'Cinzel',serif; font-size:1.4rem; font-weight:700; color:#fff; margin-bottom:4px; }
        .spell-popup-subtitle { font-size:0.85rem; color:rgba(255,255,255,0.8); font-style:italic; }
        .spell-popup-close { position:absolute; top:10px; right:15px; background:none; border:none; color:#fff; font-size:1.5rem; cursor:pointer; opacity:0.7; transition:opacity 0.2s; }
        .spell-popup-close:hover { opacity:1; }
        .spell-popup-body { padding:20px; }
        .spell-meta { display:grid; grid-template-columns:repeat(2,1fr); gap:8px; margin-bottom:15px; padding-bottom:15px; border-bottom:1px dashed var(--copper); }
        .spell-meta-item { font-size:0.9rem; }
        .spell-meta-label { font-weight:600; color:var(--ink-light); }
        .spell-description { font-size:0.95rem; line-height:1.6; }
        .spell-description p { margin-bottom:10px; }
        .spell-description p:last-child { margin-bottom:0; }
        .spell-upcast { margin-top:15px; padding-top:15px; border-top:1px dashed var(--copper); font-size:0.9rem; color:var(--ink-light); }
        .spell-upcast strong { color:var(--copper-dark); }
        .spell-link { cursor:pointer; border-bottom:1px dotted var(--ink-light); transition:all 0.2s; }
        .spell-link:hover { color:var(--copper); border-bottom-color:var(--copper); }
        .dice-toast { position:fixed; top:50%; left:50%; transform:translate(-50%,-50%) scale(0.8); background:var(--parchment); border:3px solid var(--copper); border-radius:12px; padding:25px 35px; box-shadow:0 10px 40px rgba(0,0,0,0.4); z-index:2000; text-align:center; opacity:0; transition:all 0.3s ease; pointer-events:none; }
        .dice-toast.show { opacity:1; transform:translate(-50%,-50%) scale(1); }
        .dice-toast.crit { border-color:var(--gold); background:linear-gradient(135deg,rgba(201,162,39,0.15) 0%,var(--parchment) 100%); }
        .dice-toast.fail { border-color:var(--ruby); background:linear-gradient(135deg,rgba(139,41,66,0.15) 0%,var(--parchment) 100%); }
        .dice-toast-skill { font-family:'Cinzel',serif; font-size:0.9rem; color:var(--ink-light); text-transform:uppercase; letter-spacing:0.1em; margin-bottom:8px; }
        .dice-toast-result { font-family:'Cinzel',serif; font-size:3rem; font-weight:700; color:var(--ink); line-height:1; }
        .dice-toast.crit .dice-toast-result { color:var(--gold-dark); }
        .dice-toast.fail .dice-toast-result { color:var(--ruby); }
        .dice-toast-breakdown { font-size:0.9rem; color:var(--ink-light); margin-top:8px; }
        .dice-toast-label { font-family:'Cinzel',serif; font-size:0.8rem; color:var(--copper); margin-top:5px; text-transform:uppercase; letter-spacing:0.05em; }
        .sheet { max-width:900px; margin:0 auto; background:url("data:image/svg+xml,%3Csvg viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.03'/%3E%3C/svg%3E"),var(--parchment); border:3px solid var(--border-ornate); border-radius:4px; box-shadow:0 0 0 1px var(--steel),0 4px 20px rgba(74,85,104,0.3),inset 0 0 60px rgba(74,85,104,0.05); padding:30px; position:relative; }
        .sheet::before { content:''; position:absolute; top:8px; left:8px; right:8px; bottom:8px; border:1px solid var(--copper); border-radius:2px; pointer-events:none; opacity:0.5; }
        .header { text-align:center; margin-bottom:25px; padding-bottom:20px; border-bottom:2px solid var(--copper); position:relative; }
        .header::after { content:'âš™'; position:absolute; bottom:-14px; left:50%; transform:translateX(-50%); background:var(--parchment); padding:0 15px; color:var(--copper); font-size:20px; }
        .character-name { font-family:'Cinzel',serif; font-size:3rem; font-weight:700; color:var(--ink); text-shadow:2px 2px 0 var(--parchment-dark); letter-spacing:0.15em; margin-bottom:5px; }
        .character-subtitle { font-size:1.2rem; font-style:italic; color:var(--ink-light); letter-spacing:0.05em; }
        .combat-row { display:grid; grid-template-columns:repeat(4,1fr); gap:15px; margin-bottom:25px; }
        .combat-stat { background:linear-gradient(135deg,var(--steel) 0%,var(--steel-light) 100%); border:2px solid var(--copper); border-radius:8px; padding:12px 8px; text-align:center; box-shadow:inset 0 1px 0 rgba(255,255,255,0.1),0 3px 8px rgba(0,0,0,0.2); }
        .combat-stat-label { font-family:'Cinzel',serif; font-size:0.75rem; font-weight:600; color:var(--gold); text-transform:uppercase; letter-spacing:0.1em; margin-bottom:4px; }
        .combat-stat-value { font-family:'Cinzel',serif; font-size:1.8rem; font-weight:700; color:#fff; text-shadow:1px 1px 2px rgba(0,0,0,0.3); }
        .combat-stat-note { font-size:0.7rem; color:rgba(255,255,255,0.7); font-style:italic; }
        .combat-stat.initiative-roll { cursor:pointer; transition:all 0.15s ease; }
        .combat-stat.initiative-roll:hover { transform:translateY(-2px); box-shadow:inset 0 1px 0 rgba(255,255,255,0.2),0 5px 12px rgba(0,0,0,0.3); }
        .abilities-section { margin-bottom:25px; }
        .section-title { font-family:'Cinzel',serif; font-size:1.1rem; font-weight:600; color:var(--steel); text-transform:uppercase; letter-spacing:0.15em; margin-bottom:12px; padding-bottom:5px; border-bottom:1px solid var(--copper); display:flex; align-items:center; gap:10px; }
        .section-title::before,.section-title::after { content:'â—†'; font-size:0.6rem; color:var(--copper); }
        .abilities-grid { display:grid; grid-template-columns:repeat(6,1fr); gap:10px; }
        .ability-box { background:var(--parchment-dark); border:2px solid var(--border-ornate); border-radius:8px; padding:10px 5px; text-align:center; }
        .ability-box.prof { border-color:var(--copper); background:linear-gradient(135deg,rgba(184,115,51,0.1) 0%,var(--parchment-dark) 100%); }
        .ability-name { font-family:'Cinzel',serif; font-size:0.7rem; font-weight:600; color:var(--ink-light); text-transform:uppercase; letter-spacing:0.1em; }
        .ability-score { font-family:'Cinzel',serif; font-size:1.6rem; font-weight:700; color:var(--ink); }
        .ability-mod { font-size:1rem; font-weight:600; color:var(--steel); }
        .ability-separator { height:1px; background:linear-gradient(90deg,transparent,var(--border-ornate),transparent); margin:8px 5px; }
        .ability-save { font-family:'Cinzel',serif; font-size:1rem; font-weight:700; color:var(--ink); cursor:pointer; padding:4px 8px; border-radius:4px; transition:all 0.15s ease; display:inline-block; }
        .ability-save:hover { background:var(--parchment); color:var(--copper); transform:scale(1.1); }
        .ability-box.prof .ability-save { color:var(--copper); }
        .ability-box.prof .ability-save:hover { color:var(--ruby); }
        .ability-save.conc { color:var(--gold-dark); }
        .ability-save-dual { display:flex; justify-content:center; align-items:center; gap:4px; }
        .ability-save-divider { color:var(--border-ornate); font-weight:300; }
        .ability-save-labels { display:flex; justify-content:center; gap:20px; font-size:0.6rem; color:var(--ink-light); text-transform:uppercase; letter-spacing:0.05em; margin-top:2px; }
        .skills-section { margin-bottom:25px; }
        .skills-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:6px; }
        .skill-item { display:flex; align-items:center; background:var(--parchment-dark); border:1px solid var(--border-ornate); border-radius:4px; padding:6px 8px; font-size:0.85rem; cursor:pointer; transition:all 0.15s ease; }
        .skill-item:hover { background:var(--parchment); transform:translateY(-1px); box-shadow:0 2px 4px rgba(0,0,0,0.1); }
        .skill-item:active { transform:translateY(0); }
        .skill-item.prof { background:linear-gradient(135deg,rgba(184,115,51,0.15) 0%,rgba(184,115,51,0.05) 100%); border-color:var(--copper); }
        .skill-ability { font-family:'Cinzel',serif; font-size:0.6rem; font-weight:600; color:var(--ink-light); text-transform:uppercase; width:28px; flex-shrink:0; }
        .skill-name { flex:1; color:var(--ink); }
        .skill-item.prof .skill-name { font-weight:600; color:var(--copper-dark); }
        .skill-bonus { font-family:'Cinzel',serif; font-weight:600; color:var(--ink); min-width:35px; text-align:right; }
        .skill-item.prof .skill-bonus { color:var(--copper-dark); }
        .two-columns { display:grid; grid-template-columns:1fr 1fr; gap:20px; margin-bottom:25px; }
        .info-box { background:var(--parchment-dark); border:1px solid var(--border-ornate); border-radius:6px; padding:15px; }
        .info-box h3 { font-family:'Cinzel',serif; font-size:0.9rem; font-weight:600; color:var(--steel); text-transform:uppercase; letter-spacing:0.1em; margin-bottom:10px; padding-bottom:5px; border-bottom:1px dashed var(--copper); }
        .info-box ul { list-style:none; }
        .info-box li { padding:4px 0; padding-left:18px; position:relative; font-size:0.95rem; line-height:1.4; }
        .info-box li::before { content:'â€¢'; position:absolute; left:0; color:var(--copper); }
        .rest-box { padding-bottom:15px; }
        .rest-buttons { display:flex; flex-direction:column; gap:10px; }
        .rest-btn { display:flex; align-items:center; gap:12px; padding:12px 15px; border:2px solid var(--border-ornate); border-radius:8px; background:var(--parchment); cursor:pointer; transition:all 0.2s ease; text-align:left; }
        .rest-btn:hover { transform:translateY(-2px); box-shadow:0 4px 8px rgba(0,0,0,0.15); }
        .rest-btn:active { transform:translateY(0); }
        .rest-btn.short-rest { border-color:var(--gold); background:linear-gradient(135deg,rgba(201,162,39,0.1) 0%,var(--parchment) 100%); }
        .rest-btn.short-rest:hover { background:linear-gradient(135deg,rgba(201,162,39,0.2) 0%,var(--parchment) 100%); }
        .rest-btn.long-rest { border-color:var(--copper); background:linear-gradient(135deg,rgba(184,115,51,0.1) 0%,var(--parchment) 100%); }
        .rest-btn.long-rest:hover { background:linear-gradient(135deg,rgba(184,115,51,0.2) 0%,var(--parchment) 100%); }
        .rest-icon { font-size:1.5rem; }
        .rest-label { font-family:'Cinzel',serif; font-size:1rem; font-weight:600; color:var(--ink); }
        .rest-desc { font-size:0.75rem; color:var(--ink-light); margin-left:auto; }
        .features-section { margin-bottom:25px; }
        .feature-category { background:var(--parchment-dark); border:1px solid var(--border-ornate); border-radius:6px; margin-bottom:15px; overflow:hidden; }
        .feature-category-header { background:linear-gradient(135deg,var(--steel) 0%,var(--steel-light) 100%); padding:10px 15px; font-family:'Cinzel',serif; font-size:0.9rem; font-weight:600; color:#fff; text-transform:uppercase; letter-spacing:0.1em; }
        .feature-category-header.copper { background:linear-gradient(135deg,var(--copper-dark) 0%,var(--copper) 100%); }
        .feature-category-header.ruby { background:linear-gradient(135deg,var(--ruby) 0%,#ab4962 100%); }
        .feature-category-content { padding:12px 15px; }
        .feature-item { margin-bottom:8px; font-size:0.9rem; line-height:1.5; }
        .feature-item:last-child { margin-bottom:0; }
        .feature-name { font-weight:600; color:var(--ink); }
        .feature-sub { margin-left:20px; color:var(--ink-light); font-size:0.85rem; }
        .spellcasting-header { display:grid; grid-template-columns:repeat(4,1fr); gap:10px; margin-bottom:15px; }
        .spell-stat { background:linear-gradient(135deg,var(--copper-dark) 0%,var(--copper) 100%); border:2px solid var(--steel); border-radius:6px; padding:10px; text-align:center; cursor:pointer; transition:all 0.15s ease; }
        .spell-stat:hover { transform:translateY(-2px); box-shadow:0 4px 8px rgba(0,0,0,0.2); }
        .spell-stat-label { font-family:'Cinzel',serif; font-size:0.65rem; font-weight:600; color:var(--gold); text-transform:uppercase; letter-spacing:0.05em; margin-bottom:2px; }
        .spell-stat-value { font-family:'Cinzel',serif; font-size:1.4rem; font-weight:700; color:#fff; }
        .slots-section { display:grid; grid-template-columns:repeat(3,1fr); gap:10px; margin-bottom:20px; }
        .slot-box { background:var(--parchment-dark); border:1px solid var(--border-ornate); border-radius:6px; padding:10px; text-align:center; }
        .slot-label { font-family:'Cinzel',serif; font-size:0.75rem; font-weight:600; color:var(--ink-light); text-transform:uppercase; margin-bottom:8px; }
        .slot-checkboxes { display:flex; justify-content:center; gap:6px; flex-wrap:wrap; }
        .slot-checkbox { width:22px; height:22px; cursor:pointer; accent-color:var(--copper); }
        .spell-level { background:var(--parchment-dark); border:1px solid var(--border-ornate); border-radius:6px; margin-bottom:10px; overflow:hidden; }
        .spell-level-header { background:linear-gradient(135deg,var(--steel) 0%,var(--steel-light) 100%); padding:8px 15px; font-family:'Cinzel',serif; font-size:0.85rem; font-weight:600; color:#fff; text-transform:uppercase; letter-spacing:0.1em; }
        .spell-level-content { padding:12px 15px; font-size:0.95rem; line-height:1.8; }
        .spell-tag { font-size:0.65rem; padding:2px 6px; border-radius:3px; text-transform:uppercase; font-weight:600; vertical-align:middle; margin-left:2px; }
        .spell-tag.subclass { background:var(--copper); color:#fff; }
        .attack-item { background:var(--parchment-dark); border:1px solid var(--border-ornate); border-radius:6px; padding:12px 15px; display:flex; align-items:center; gap:10px; margin-bottom:8px; cursor:pointer; transition:all 0.15s ease; flex-wrap:wrap; }
        .attack-item:hover { transform:translateY(-1px); box-shadow:0 2px 4px rgba(0,0,0,0.1); }
        .attack-name { font-family:'Cinzel',serif; font-weight:600; color:var(--ink); min-width:100px; flex-shrink:0; }
        .attack-hit { font-family:'Cinzel',serif; font-weight:700; color:var(--copper); flex-shrink:0; }
        .attack-damage { font-family:'Cinzel',serif; font-weight:600; color:var(--steel); }
        .attack-notes { font-size:0.8rem; color:var(--ink-light); font-style:italic; margin-left:auto; flex-shrink:0; }
        .defender-section { margin-bottom:25px; }
        .defender-box { background:linear-gradient(135deg,rgba(74,85,104,0.08) 0%,var(--parchment-dark) 100%); border:2px solid var(--steel); border-radius:8px; overflow:hidden; }
        .defender-header { background:linear-gradient(135deg,var(--steel) 0%,var(--steel-light) 100%); padding:12px 15px; display:flex; justify-content:space-between; align-items:center; }
        .defender-title { font-family:'Cinzel',serif; font-weight:700; font-size:1.1rem; color:#fff; letter-spacing:0.05em; }
        .defender-subtitle { font-size:0.8rem; color:rgba(255,255,255,0.7); font-style:italic; }
        .defender-content { padding:15px; }
        .defender-stats-row { display:grid; grid-template-columns:repeat(4,1fr); gap:10px; margin-bottom:12px; }
        .defender-stat-box { background:var(--parchment); border:1px solid var(--border-ornate); border-radius:6px; padding:8px; text-align:center; }
        .defender-stat-label { font-family:'Cinzel',serif; font-size:0.65rem; font-weight:600; color:var(--ink-light); text-transform:uppercase; letter-spacing:0.05em; }
        .defender-stat-value { font-family:'Cinzel',serif; font-size:1.3rem; font-weight:700; color:var(--steel); }
        .defender-abilities { display:grid; grid-template-columns:repeat(6,1fr); gap:6px; margin-bottom:12px; }
        .defender-ability { background:var(--parchment); border:1px solid var(--border-ornate); border-radius:4px; padding:6px 4px; text-align:center; }
        .defender-ability-name { font-family:'Cinzel',serif; font-size:0.6rem; font-weight:600; color:var(--ink-light); text-transform:uppercase; }
        .defender-ability-score { font-family:'Cinzel',serif; font-size:1rem; font-weight:700; color:var(--ink); }
        .defender-ability-mod { font-size:0.8rem; color:var(--steel); }
        .defender-traits { margin-bottom:12px; }
        .defender-trait { margin-bottom:8px; font-size:0.9rem; line-height:1.5; }
        .defender-trait-name { font-weight:600; color:var(--steel); }
        .defender-actions { border-top:1px dashed var(--copper); padding-top:12px; }
        .defender-action { margin-bottom:10px; font-size:0.9rem; line-height:1.5; }
        .defender-action-name { font-weight:600; color:var(--copper-dark); }
        .defender-hp-tracker { display:flex; align-items:center; justify-content:center; gap:10px; }
        .defender-hp-input { font-family:'Cinzel',serif; font-size:1.3rem; font-weight:700; color:var(--steel); width:50px; text-align:center; border:none; background:transparent; border-bottom:2px solid var(--copper); }
        .defender-hp-input:focus { outline:none; border-bottom-color:var(--gold); }
        .defender-hp-max { font-size:0.9rem; color:var(--ink-light); }
        .repair-charge { width:20px; height:20px; border:2px solid var(--copper); border-radius:50%; background:var(--parchment); cursor:pointer; transition:all 0.2s; display:inline-block; }
        .repair-charge.used { background:var(--copper); }
        .defender-repair-charges { display:flex; gap:6px; align-items:center; justify-content:center; }
        .flash-section { margin-bottom:25px; }
        .flash-box { background:linear-gradient(135deg,rgba(201,162,39,0.1) 0%,var(--parchment-dark) 100%); border:2px solid var(--gold); border-radius:8px; padding:15px; }
        .flash-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; }
        .flash-title { font-family:'Cinzel',serif; font-weight:600; font-size:1.1rem; color:var(--gold-dark); }
        .flash-charges { display:flex; gap:8px; }
        .flash-charge { width:24px; height:24px; border:2px solid var(--gold); border-radius:50%; background:var(--parchment); cursor:pointer; transition:all 0.2s; }
        .flash-charge.used { background:var(--gold); }
        .flash-desc { font-size:0.9rem; color:var(--ink-light); line-height:1.5; }
        .tinker-section { margin-bottom:25px; }
        .tinker-box { background:var(--parchment-dark); border:1px solid var(--border-ornate); border-radius:6px; padding:15px; }
        .tinker-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; }
        .tinker-title { font-family:'Cinzel',serif; font-weight:600; font-size:1rem; color:var(--steel); }
        .tinker-charges { display:flex; gap:6px; }
        .tinker-charge { width:22px; height:22px; border:2px solid var(--copper); border-radius:50%; background:var(--parchment); cursor:pointer; transition:all 0.2s; }
        .tinker-charge.used { background:var(--copper); }
        .tinker-desc { font-size:0.85rem; color:var(--ink-light); line-height:1.4; }
        .tinker-ability-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:10px; }
        .tinker-ability-item { background:linear-gradient(135deg,rgba(184,115,51,0.1) 0%,var(--parchment-dark) 100%); border:2px solid var(--copper); border-radius:6px; padding:12px; }
        .tinker-ability-name { font-family:'Cinzel',serif; font-weight:600; color:var(--copper-dark); margin-bottom:4px; font-size:0.9rem; }
        .tinker-ability-action { font-size:0.75rem; color:var(--gold-dark); font-weight:600; margin-bottom:6px; }
        .tinker-ability-desc { font-size:0.8rem; color:var(--ink-light); line-height:1.4; }
        .tinker-ability-tracker { display:flex; align-items:center; gap:6px; margin-top:8px; }
        .tinker-ability-charge { width:18px; height:18px; border:2px solid var(--copper); border-radius:50%; background:var(--parchment); cursor:pointer; transition:all 0.2s; }
        .tinker-ability-charge.used { background:var(--copper); }
        .tinker-ability-label { font-size:0.7rem; color:var(--ink-light); }
        .magic-items-section { margin-bottom:25px; }
        .magic-items-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:10px; }
        .magic-item-card { background:linear-gradient(135deg,rgba(184,115,51,0.1) 0%,var(--parchment-dark) 100%); border:2px solid var(--copper); border-radius:6px; padding:12px; text-align:center; }
        .magic-item-card.inactive { border-color:var(--border-ornate); opacity:0.6; background:var(--parchment-dark); }
        .magic-item-name { font-family:'Cinzel',serif; font-weight:600; font-size:0.85rem; color:var(--copper-dark); margin-bottom:4px; }
        .magic-item-card.inactive .magic-item-name { color:var(--ink-light); }
        .magic-item-rarity { font-size:0.7rem; color:var(--ink-light); font-style:italic; }
        .magic-item-status { font-size:0.7rem; font-weight:600; color:var(--copper); margin-top:4px; }
        .magic-item-card.inactive .magic-item-status { color:var(--ink-light); }
        .attacks-section { margin-bottom:25px; }
        .tinker-abilities-section { margin-bottom:25px; }
        @media (max-width:768px) {
            .sheet { padding:15px; } .character-name { font-size:2rem; }
            .combat-row { grid-template-columns:repeat(2,1fr); }
            .abilities-grid { grid-template-columns:repeat(3,1fr); }
            .skills-grid { grid-template-columns:repeat(2,1fr); }
            .two-columns { grid-template-columns:1fr; }
            .spellcasting-header { grid-template-columns:repeat(2,1fr); }
            .slots-section { grid-template-columns:repeat(2,1fr); }
            .magic-items-grid { grid-template-columns:1fr; }
            .defender-stats-row { grid-template-columns:repeat(2,1fr); }
            .defender-abilities { grid-template-columns:repeat(3,1fr); }
            .tinker-ability-grid { grid-template-columns:1fr; }
        }
        @media (max-width:480px) { .skills-grid { grid-template-columns:1fr; } .abilities-grid { grid-template-columns:repeat(2,1fr); }
            .attack-name { min-width:auto; width:100%; } .attack-notes { margin-left:0; } }
        @media print { body { background:white; padding:0; } .sheet { box-shadow:none; border:1px solid #ccc; } }
    </style>
</head>
<body>
    <div class="sheet">
        <div class="header">
            <h1 class="character-name">ARTIFICER</h1>
            <p class="character-subtitle">Human Battle Smith 7 â€¢ House Cannith Heir</p>
        </div>
        <div class="combat-row">
            <div class="combat-stat"><div class="combat-stat-label">Armor Class</div><div class="combat-stat-value">21</div><div class="combat-stat-note">Medium +1, Shield +1</div></div>
            <div class="combat-stat"><div class="combat-stat-label">Hit Points</div><div class="combat-stat-value">73</div><div class="combat-stat-note">7d8 + 21 + 14 (Tough)</div></div>
            <div class="combat-stat"><div class="combat-stat-label">Speed</div><div class="combat-stat-value">30 ft</div><div class="combat-stat-note">Human</div></div>
            <div class="combat-stat initiative-roll" data-bonus="2"><div class="combat-stat-label">Initiative</div><div class="combat-stat-value">+2</div><div class="combat-stat-note">DEX (click to roll)</div></div>
        </div>
        <div class="abilities-section">
            <h2 class="section-title">Ability Scores</h2>
            <div class="abilities-grid">
                <div class="ability-box"><div class="ability-name">STR</div><div class="ability-score">10</div><div class="ability-mod">+0</div><div class="ability-separator"></div><div class="ability-save" data-save="Strength" data-bonus="0">+0</div></div>
                <div class="ability-box"><div class="ability-name">DEX</div><div class="ability-score">14</div><div class="ability-mod">+2</div><div class="ability-separator"></div><div class="ability-save" data-save="Dexterity" data-bonus="2">+2</div></div>
                <div class="ability-box prof"><div class="ability-name">CON</div><div class="ability-score">16</div><div class="ability-mod">+3</div><div class="ability-separator"></div>
                    <div class="ability-save-dual"><div class="ability-save" data-save="Constitution" data-bonus="6">+6</div><div class="ability-save-divider">|</div><div class="ability-save conc" data-save="Concentration" data-bonus="6">+6</div></div>
                    <div class="ability-save-labels"><span>save</span><span>conc (adv)</span></div>
                </div>
                <div class="ability-box prof"><div class="ability-name">INT</div><div class="ability-score">18</div><div class="ability-mod">+4</div><div class="ability-separator"></div><div class="ability-save" data-save="Intelligence" data-bonus="7">+7</div></div>
                <div class="ability-box"><div class="ability-name">WIS</div><div class="ability-score">12</div><div class="ability-mod">+1</div><div class="ability-separator"></div><div class="ability-save" data-save="Wisdom" data-bonus="1">+1</div></div>
                <div class="ability-box"><div class="ability-name">CHA</div><div class="ability-score">12</div><div class="ability-mod">+1</div><div class="ability-separator"></div><div class="ability-save" data-save="Charisma" data-bonus="1">+1</div></div>
            </div>
        </div>
        <div class="skills-section">
            <h2 class="section-title">Skills</h2>
            <div class="skills-grid">
                <div class="skill-item" data-skill="Acrobatics" data-bonus="2"><span class="skill-ability">DEX</span><span class="skill-name">Acrobatics</span><span class="skill-bonus">+2</span></div>
                <div class="skill-item" data-skill="Animal Handling" data-bonus="1"><span class="skill-ability">WIS</span><span class="skill-name">Animal Handling</span><span class="skill-bonus">+1</span></div>
                <div class="skill-item prof" data-skill="Arcana" data-bonus="7"><span class="skill-ability">INT</span><span class="skill-name">Arcana</span><span class="skill-bonus">+7</span></div>
                <div class="skill-item" data-skill="Athletics" data-bonus="0"><span class="skill-ability">STR</span><span class="skill-name">Athletics</span><span class="skill-bonus">+0</span></div>
                <div class="skill-item" data-skill="Deception" data-bonus="1"><span class="skill-ability">CHA</span><span class="skill-name">Deception</span><span class="skill-bonus">+1</span></div>
                <div class="skill-item prof" data-skill="History" data-bonus="7"><span class="skill-ability">INT</span><span class="skill-name">History</span><span class="skill-bonus">+7</span></div>
                <div class="skill-item prof" data-skill="Insight" data-bonus="4"><span class="skill-ability">WIS</span><span class="skill-name">Insight</span><span class="skill-bonus">+4</span></div>
                <div class="skill-item" data-skill="Intimidation" data-bonus="1"><span class="skill-ability">CHA</span><span class="skill-name">Intimidation</span><span class="skill-bonus">+1</span></div>
                <div class="skill-item prof" data-skill="Investigation" data-bonus="7"><span class="skill-ability">INT</span><span class="skill-name">Investigation</span><span class="skill-bonus">+7</span></div>
                <div class="skill-item" data-skill="Medicine" data-bonus="1"><span class="skill-ability">WIS</span><span class="skill-name">Medicine</span><span class="skill-bonus">+1</span></div>
                <div class="skill-item" data-skill="Nature" data-bonus="4"><span class="skill-ability">INT</span><span class="skill-name">Nature</span><span class="skill-bonus">+4</span></div>
                <div class="skill-item prof" data-skill="Perception" data-bonus="4"><span class="skill-ability">WIS</span><span class="skill-name">Perception</span><span class="skill-bonus">+4</span></div>
                <div class="skill-item" data-skill="Performance" data-bonus="1"><span class="skill-ability">CHA</span><span class="skill-name">Performance</span><span class="skill-bonus">+1</span></div>
                <div class="skill-item prof" data-skill="Persuasion" data-bonus="4"><span class="skill-ability">CHA</span><span class="skill-name">Persuasion</span><span class="skill-bonus">+4</span></div>
                <div class="skill-item" data-skill="Religion" data-bonus="4"><span class="skill-ability">INT</span><span class="skill-name">Religion</span><span class="skill-bonus">+4</span></div>
                <div class="skill-item prof" data-skill="Sleight of Hand" data-bonus="5"><span class="skill-ability">DEX</span><span class="skill-name">Sleight of Hand</span><span class="skill-bonus">+5</span></div>
                <div class="skill-item prof" data-skill="Stealth" data-bonus="5"><span class="skill-ability">DEX</span><span class="skill-name">Stealth</span><span class="skill-bonus">+5</span></div>
                <div class="skill-item" data-skill="Survival" data-bonus="1"><span class="skill-ability">WIS</span><span class="skill-name">Survival</span><span class="skill-bonus">+1</span></div>
            </div>
        </div>
        <div class="two-columns">
            <div class="info-box"><h3>Proficiencies</h3><ul>
                <li><strong>Armor:</strong> Light, Medium, Shields</li>
                <li><strong>Weapons:</strong> Simple, Martial</li>
                <li><strong>Tools:</strong> Tinker's Tools, Smith's Tools, Thieves' Tools</li>
                <li><strong>Languages:</strong> Common</li>
            </ul></div>
            <div class="info-box rest-box"><h3>Rest</h3><div class="rest-buttons">
                <button class="rest-btn short-rest" onclick="shortRest()"><span class="rest-icon">â˜€</span><span class="rest-label">Short Rest</span><span class="rest-desc">Hit Dice recovery</span></button>
                <button class="rest-btn long-rest" onclick="longRest()"><span class="rest-icon">â˜½</span><span class="rest-label">Long Rest</span><span class="rest-desc">All resources restored</span></button>
            </div></div>
        </div>
        <div class="attacks-section">
            <h2 class="section-title">Attacks</h2>
            <div class="attack-item" onclick="rollAttack('Arcanum Edge', 8, '1d8', 5, 'Slashing')"><span class="attack-name">âš” Arcanum Edge</span><span class="attack-hit">+8</span><span class="attack-damage">1d8 + 5 slashing</span><span class="attack-notes">Legendary â€¢ Spellstrike</span></div>
            <div class="attack-item" onclick="rollAttack('Defender Rend', 7, '1d8', 6, 'Force')"><span class="attack-name">ðŸ›¡ Defender: Rend</span><span class="attack-hit">+8</span><span class="attack-damage">1d8 + 6 force</span><span class="attack-notes">Bonus Action command or in place of one attack</span></div>
        </div>
        <div class="features-section">
            <h2 class="section-title">Features & Traits</h2>
            <div class="feature-category"><div class="feature-category-header">Human Traits</div><div class="feature-category-content">
                <div class="feature-item"><span class="feature-name">Resourceful:</span> Gain Heroic Inspiration on Long Rest</div>
                <div class="feature-item"><span class="feature-name">Versatile:</span> Skilled (3 extra proficiencies), Tough (+2 HP/level)</div>
            </div></div>
            <div class="feature-category"><div class="feature-category-header">Artificer Features (Level 7)</div><div class="feature-category-content">
                <div class="feature-item"><span class="feature-name">Tinker's Magic:</span> Create mundane items (Magic action). 4 uses/Long Rest</div>
                <div class="feature-item"><span class="feature-name">Replicate Magic Item:</span> 5 plans known, 3 items created at end of Long Rest</div>
                <div class="feature-item"><span class="feature-name">Magic Item Tinker:</span> Charge, Drain, or Transmute created magic items</div>
                <div class="feature-item"><span class="feature-name">Flash of Genius</span> (4/LR, Reaction): +4 (INT) to failed check or save within 30 ft</div>
            </div></div>
            <div class="feature-category"><div class="feature-category-header copper">Battle Smith</div><div class="feature-category-content">
                <div class="feature-item"><span class="feature-name">Arcane Empowerment:</span> Use INT for attack/damage with magic weapons</div>
                <div class="feature-item"><span class="feature-name">Weapon Knowledge:</span> Martial proficiency. Proficient weapon = Spellcasting Focus</div>
                <div class="feature-item"><span class="feature-name">Steel Defender:</span> Companion construct. Dodge unless commanded (Bonus Action)</div>
                <div class="feature-item"><span class="feature-name">Extra Attack:</span> 2 attacks. Can forgo one to command Defender's Rend</div>
            </div></div>
            <div class="feature-category"><div class="feature-category-header ruby">Feats</div><div class="feature-category-content">
                <div class="feature-item"><span class="feature-name">War Caster:</span> Advantage on CON Concentration saves. Reactive Spell. Somatic with hands full</div>
                <div class="feature-item"><span class="feature-name">Tough:</span> +14 HP total (+2/level)</div>
                <div class="feature-item"><span class="feature-name">Skilled:</span> 3 additional skill proficiencies</div>
            </div></div>
            <div class="feature-category"><div class="feature-category-header">Background: House Cannith Heir</div><div class="feature-category-content">
                <div class="feature-item"><span class="feature-name">House Cannith:</span> Mark of Making</div>
            </div></div>
        </div>
        <div class="flash-section">
            <h2 class="section-title">Flash of Genius</h2>
            <div class="flash-box">
                <div class="flash-header">
                    <span class="flash-title">âš¡ Charges (4/Long Rest)</span>
                    <div class="flash-charges">
                        <div class="flash-charge" id="flashCharge1" onclick="toggleFlashCharge(1)"></div>
                        <div class="flash-charge" id="flashCharge2" onclick="toggleFlashCharge(2)"></div>
                        <div class="flash-charge" id="flashCharge3" onclick="toggleFlashCharge(3)"></div>
                        <div class="flash-charge" id="flashCharge4" onclick="toggleFlashCharge(4)"></div>
                    </div>
                </div>
                <div class="flash-desc"><strong>Reaction:</strong> When you or a creature within 30 ft fails an ability check or saving throw, add +4 (INT) to the roll.</div>
            </div>
        </div>
        <div class="tinker-section">
            <h2 class="section-title">Tinker's Magic</h2>
            <div class="tinker-box">
                <div class="tinker-header">
                    <span class="tinker-title">Create Mundane Items (4/LR)</span>
                    <div class="tinker-charges">
                        <div class="tinker-charge" id="tinkerCharge1" onclick="toggleTinkerCharge(1)"></div>
                        <div class="tinker-charge" id="tinkerCharge2" onclick="toggleTinkerCharge(2)"></div>
                        <div class="tinker-charge" id="tinkerCharge3" onclick="toggleTinkerCharge(3)"></div>
                        <div class="tinker-charge" id="tinkerCharge4" onclick="toggleTinkerCharge(4)"></div>
                    </div>
                </div>
                <div class="tinker-desc">Magic action + Tinker's Tools. Create one item (rope, net, crowbar, torch, etc.) within 5 ft. Lasts until Long Rest.</div>
            </div>
        </div>
        <div class="tinker-abilities-section">
            <h2 class="section-title">Magic Item Tinker</h2>
            <div class="tinker-ability-grid">
                <div class="tinker-ability-item"><div class="tinker-ability-name">Charge Magic Item</div><div class="tinker-ability-action">Bonus Action</div><div class="tinker-ability-desc">Expend a spell slot to recharge a created item. Charges = slot level.</div></div>
                <div class="tinker-ability-item"><div class="tinker-ability-name">Drain Magic Item</div><div class="tinker-ability-action">Bonus Action â€¢ 1/LR</div><div class="tinker-ability-desc">Destroy a created item â†’ spell slot (Lvl 1 Common, Lvl 2 Uncommon+).</div>
                    <div class="tinker-ability-tracker"><div class="tinker-ability-charge" id="drainCharge" onclick="toggleDrainCharge()"></div><span class="tinker-ability-label">Used</span></div></div>
                <div class="tinker-ability-item"><div class="tinker-ability-name">Transmute Magic Item</div><div class="tinker-ability-action">Magic Action â€¢ 1/LR</div><div class="tinker-ability-desc">Transform one created item into a different item (must know the plan).</div>
                    <div class="tinker-ability-tracker"><div class="tinker-ability-charge" id="transmuteCharge" onclick="toggleTransmuteCharge()"></div><span class="tinker-ability-label">Used</span></div></div>
            </div>
        </div>
        <div class="magic-items-section">
            <h2 class="section-title">Replicate Magic Items</h2>
            <p style="font-size:0.85rem;color:var(--ink-light);margin-bottom:12px;font-style:italic;">5 Plans Known â€¢ 3 Items Created</p>
            <div class="magic-items-grid">
                <div class="magic-item-card"><div class="magic-item-name">Armor +1</div><div class="magic-item-rarity">Uncommon â€¢ Medium</div><div class="magic-item-status">âœ“ CREATED</div></div>
                <div class="magic-item-card"><div class="magic-item-name">Shield +1</div><div class="magic-item-rarity">Uncommon</div><div class="magic-item-status">âœ“ CREATED</div></div>
                <div class="magic-item-card"><div class="magic-item-name">Spell Refueling Ring</div><div class="magic-item-rarity">Uncommon (Attunement)</div><div class="magic-item-status">âœ“ CREATED</div></div>
                <div class="magic-item-card inactive"><div class="magic-item-name">Bag of Holding</div><div class="magic-item-rarity">Uncommon</div><div class="magic-item-status">Plan Known</div></div>
                <div class="magic-item-card inactive"><div class="magic-item-name">Sending Stones</div><div class="magic-item-rarity">Uncommon</div><div class="magic-item-status">Plan Known</div></div>
            </div>
        </div>
        <div class="features-section" style="margin-bottom:25px;">
            <h2 class="section-title">Arcanum Edge - Legendary Weapon</h2>
            <div class="feature-category"><div class="feature-category-header copper">Dormant State</div><div class="feature-category-content">
                <div class="feature-item"><span class="feature-name">Magic Weapon:</span> +1 bonus to attack and damage rolls</div>
                <div class="feature-item"><span class="feature-name">Arcane Conduit:</span> Can be used as spellcasting focus for Artificer spells</div>
                <div class="feature-item" style="margin-top:10px;"><span class="feature-name">Spellstrike:</span> When you take the Attack action, replace one attack with a Spellstrike. Cast an Artificer spell (1 action casting time) and infuse it into the weapon, then make a melee weapon attack.</div>
                <div class="feature-sub">â€¢ <strong>Attack Roll Spells:</strong> If the spell requires an attack roll (melee or ranged), it automatically hits the target if the weapon attack hits and misses if the weapon attack misses.</div>
                <div class="feature-sub">â€¢ <strong>Saving Throw Spells:</strong> If the spell requires a saving throw, a hit automatically deals damage as if the target failed its save. Any effects besides damage require the target to make the saving throw as normal (regardless of whether the attack hits or misses). If the spell deals half damage on a successful save, a missed attack deals half damage, treating it as a successful save. If a spell always hits (such as *magic missile*), the spell hits regardless of whether the weapon attack hits or misses.</div>
                <div class="feature-sub">â€¢ <strong>Area of Effect:</strong> If the spell has an area of effect, that area must include the space the target occupies, and one edge of the area must be within the reach of this weapon. Other creatures in the area treat the spell as if you had cast it normally. The Spellstrike target is not affected by the spell again, having already resolved its effects as part of the attack.</div>
                <div class="feature-sub">â€¢ <strong>Multiple Attacks:</strong> For spells with multiple attack rolls (such as *scorching ray*), only the first attack roll is tied to the melee weapon attack. Subsequent attack rolls resolve as if you had cast the spell normally, but you ignore disadvantage on ranged spell attack rolls from being within 5 feet of hostile creatures.</div>
            </div></div>
        </div>
        <div class="defender-section">
            <h2 class="section-title">Steel Defender</h2>
            <div class="defender-box">
                <div class="defender-header"><div><div class="defender-title">Steel Defender</div><div class="defender-subtitle">Medium Construct â€¢ Bipedal Warforged Form</div></div></div>
                <div class="defender-content">
                    <div class="defender-stats-row">
                        <div class="defender-stat-box"><div class="defender-stat-label">AC</div><div class="defender-stat-value">16</div></div>
                        <div class="defender-stat-box"><div class="defender-stat-label">HP</div><div class="defender-hp-tracker"><input type="number" class="defender-hp-input" id="defenderHP" value="40" min="0" max="40" onchange="saveState()"><span class="defender-hp-max">/ 40</span></div></div>
                        <div class="defender-stat-box"><div class="defender-stat-label">Speed</div><div class="defender-stat-value">40 ft</div></div>
                        <div class="defender-stat-box"><div class="defender-stat-label">Repair (3/Day)</div><div class="defender-repair-charges"><div class="repair-charge" id="repairCharge1" onclick="toggleRepairCharge(1)"></div><div class="repair-charge" id="repairCharge2" onclick="toggleRepairCharge(2)"></div><div class="repair-charge" id="repairCharge3" onclick="toggleRepairCharge(3)"></div></div></div>
                    </div>
                    <div class="defender-abilities">
                        <div class="defender-ability"><div class="defender-ability-name">STR</div><div class="defender-ability-score">14</div><div class="defender-ability-mod">+2 / +5</div></div>
                        <div class="defender-ability"><div class="defender-ability-name">DEX</div><div class="defender-ability-score">12</div><div class="defender-ability-mod">+1 / +4</div></div>
                        <div class="defender-ability"><div class="defender-ability-name">CON</div><div class="defender-ability-score">14</div><div class="defender-ability-mod">+2 / +5</div></div>
                        <div class="defender-ability"><div class="defender-ability-name">INT</div><div class="defender-ability-score">4</div><div class="defender-ability-mod">âˆ’3 / +0</div></div>
                        <div class="defender-ability"><div class="defender-ability-name">WIS</div><div class="defender-ability-score">10</div><div class="defender-ability-mod">+0 / +3</div></div>
                        <div class="defender-ability"><div class="defender-ability-name">CHA</div><div class="defender-ability-score">6</div><div class="defender-ability-mod">âˆ’2 / +1</div></div>
                    </div>
                    <div class="defender-traits">
                        <div class="defender-trait"><span class="defender-trait-name">Immunities:</span> Poison dmg; Charmed, Exhaustion, Poisoned</div>
                        <div class="defender-trait"><span class="defender-trait-name">Senses:</span> Darkvision 60 ft, Passive Perception 10</div>
                        <div class="defender-trait"><span class="defender-trait-name">Steel Bond:</span> +PB (+3) to checks and saves (shown as mod / save)</div>
                    </div>
                    <div class="defender-actions">
                        <div class="defender-action"><span class="defender-action-name">Force-Empowered Rend:</span> +7 to hit, 5 ft. 1d8 + 6 Force</div>
                        <div class="defender-action"><span class="defender-action-name">Repair (3/Day):</span> Defender or Construct within 5 ft regains 2d8 + 4 HP</div>
                        <div class="defender-action"><span class="defender-action-name">Deflect Attack (Reaction):</span> Creature within 5 ft attacking another has Disadvantage</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="spellcasting-section">
            <h2 class="section-title">Spellcasting</h2>
            <div class="spellcasting-header">
                <div class="spell-stat" onclick="showDiceRoll('Spell Attack', 7)"><div class="spell-stat-label">Spell Attack</div><div class="spell-stat-value">+7</div></div>
                <div class="spell-stat"><div class="spell-stat-label">Spell Save DC</div><div class="spell-stat-value">15</div></div>
                <div class="spell-stat"><div class="spell-stat-label">Ability</div><div class="spell-stat-value">INT</div></div>
                <div class="spell-stat"><div class="spell-stat-label">Prepared</div><div class="spell-stat-value">9 + 6</div></div>
            </div>
            <div class="slots-section">
                <div class="slot-box"><div class="slot-label">1st Level</div><div class="slot-checkboxes"><input type="checkbox" class="slot-checkbox"><input type="checkbox" class="slot-checkbox"><input type="checkbox" class="slot-checkbox"><input type="checkbox" class="slot-checkbox"></div></div>
                <div class="slot-box"><div class="slot-label">2nd Level</div><div class="slot-checkboxes"><input type="checkbox" class="slot-checkbox"><input type="checkbox" class="slot-checkbox"><input type="checkbox" class="slot-checkbox"></div></div>
                <div class="slot-box"><div class="slot-label">3rd Level</div><div class="slot-checkboxes"><input type="checkbox" class="slot-checkbox"><input type="checkbox" class="slot-checkbox"></div></div>
            </div>
            <div class="spell-level"><div class="spell-level-header">Cantrips</div><div class="spell-level-content">
                <span class="spell-link" data-spell="mending">Mending</span>,
                <span class="spell-link" data-spell="shocking-grasp">Shocking Grasp</span>,
                <span class="spell-link" data-spell="prestidigitation">Prestidigitation</span>
            </div></div>
            <div class="spell-level"><div class="spell-level-header">1st Level</div><div class="spell-level-content">
                <span class="spell-link" data-spell="heroism">Heroism</span> <span class="spell-tag subclass">BS</span>, 
                <span class="spell-link" data-spell="shield">Shield</span> <span class="spell-tag subclass">BS</span>, 
                <span class="spell-link" data-spell="cure-wounds">Cure Wounds</span>, 
                <span class="spell-link" data-spell="disguise-self">Disguise Self</span>, 
                <span class="spell-link" data-spell="faerie-fire">Faerie Fire</span>
            </div></div>
            <div class="spell-level"><div class="spell-level-header">2nd Level</div><div class="spell-level-content">
                <span class="spell-link" data-spell="shining-smite">Shining Smite</span> <span class="spell-tag subclass">BS</span>, 
                <span class="spell-link" data-spell="warding-bond">Warding Bond</span> <span class="spell-tag subclass">BS</span>, 
                <span class="spell-link" data-spell="invisibility">Invisibility</span>, 
                <span class="spell-link" data-spell="blur">Blur</span>, 
                <span class="spell-link" data-spell="homunculus-servant">Homunculus Servant</span>, 
                <span class="spell-link" data-spell="darkvision-spell">Darkvision</span>
            </div></div>
            <div class="spell-level"><div class="spell-level-header">3rd Level</div><div class="spell-level-content">
                <span class="spell-link" data-spell="aura-of-vitality">Aura of Vitality</span> <span class="spell-tag subclass">BS</span>, 
                <span class="spell-link" data-spell="conjure-barrage">Conjure Barrage</span> <span class="spell-tag subclass">BS</span>, 
                <span class="spell-link" data-spell="fly">Fly</span>, 
                <span class="spell-link" data-spell="haste">Haste</span>
            </div></div>
        </div>
    </div>
    <div class="spell-overlay" id="spellOverlay">
        <div class="spell-popup">
            <div class="spell-popup-header" id="spellHeader">
                <h3 class="spell-popup-title" id="spellTitle"></h3>
                <p class="spell-popup-subtitle" id="spellSubtitle"></p>
                <button class="spell-popup-close" onclick="closeSpellPopup()">Ã—</button>
            </div>
            <div class="spell-popup-body">
                <div class="spell-meta" id="spellMeta"></div>
                <div class="spell-description" id="spellDescription"></div>
                <div class="spell-upcast" id="spellUpcast"></div>
            </div>
        </div>
    </div>
    <div class="dice-toast" id="diceToast">
        <div class="dice-toast-skill" id="diceSkill"></div>
        <div class="dice-toast-result" id="diceResult"></div>
        <div class="dice-toast-breakdown" id="diceBreakdown"></div>
        <div class="dice-toast-label" id="diceLabel"></div>
    </div>
    <script>
        const STORAGE_KEY = 'artificer_battlesmith_sheet';
        function saveState() {
            const state = { spellSlots:[], flashCharges:[], tinkerCharges:[], repairCharges:[],
                drainUsed: document.getElementById('drainCharge').classList.contains('used'),
                transmuteUsed: document.getElementById('transmuteCharge').classList.contains('used'),
                defenderHP: document.getElementById('defenderHP').value };
            document.querySelectorAll('.slot-checkbox').forEach(cb => state.spellSlots.push(cb.checked));
            for(let i=1;i<=4;i++) state.flashCharges.push(document.getElementById('flashCharge'+i).classList.contains('used'));
            for(let i=1;i<=4;i++) state.tinkerCharges.push(document.getElementById('tinkerCharge'+i).classList.contains('used'));
            for(let i=1;i<=3;i++) state.repairCharges.push(document.getElementById('repairCharge'+i).classList.contains('used'));
            localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
        }
        function loadState() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if(!saved) return;
            try {
                const state = JSON.parse(saved);
                const slots = document.querySelectorAll('.slot-checkbox');
                state.spellSlots.forEach((c,i) => { if(slots[i]) slots[i].checked = c; });
                state.flashCharges.forEach((u,i) => { if(u) document.getElementById('flashCharge'+(i+1)).classList.add('used'); });
                state.tinkerCharges.forEach((u,i) => { if(u) document.getElementById('tinkerCharge'+(i+1)).classList.add('used'); });
                state.repairCharges.forEach((u,i) => { if(u) document.getElementById('repairCharge'+(i+1)).classList.add('used'); });
                if(state.drainUsed) document.getElementById('drainCharge').classList.add('used');
                if(state.transmuteUsed) document.getElementById('transmuteCharge').classList.add('used');
                if(state.defenderHP !== undefined) document.getElementById('defenderHP').value = state.defenderHP;
            } catch(e) { console.error('Error loading state:', e); }
        }
        function setupAutoSave() { document.querySelectorAll('.slot-checkbox').forEach(cb => cb.addEventListener('change', saveState)); }
        document.addEventListener('DOMContentLoaded', () => { loadState(); setupAutoSave(); });

        function toggleFlashCharge(n) { document.getElementById('flashCharge'+n).classList.toggle('used'); saveState(); }
        function toggleTinkerCharge(n) { document.getElementById('tinkerCharge'+n).classList.toggle('used'); saveState(); }
        function toggleRepairCharge(n) { document.getElementById('repairCharge'+n).classList.toggle('used'); saveState(); }
        function toggleDrainCharge() { document.getElementById('drainCharge').classList.toggle('used'); saveState(); }
        function toggleTransmuteCharge() { document.getElementById('transmuteCharge').classList.toggle('used'); saveState(); }

        function shortRest() { showRestToast('Short Rest', 'Hit Dice & short rest features'); }
        function longRest() {
            document.querySelectorAll('.slot-checkbox').forEach(cb => cb.checked = false);
            for(let i=1;i<=4;i++) document.getElementById('flashCharge'+i).classList.remove('used');
            for(let i=1;i<=4;i++) document.getElementById('tinkerCharge'+i).classList.remove('used');
            for(let i=1;i<=3;i++) document.getElementById('repairCharge'+i).classList.remove('used');
            document.getElementById('drainCharge').classList.remove('used');
            document.getElementById('transmuteCharge').classList.remove('used');
            document.getElementById('defenderHP').value = 40;
            saveState();
            showRestToast('Long Rest', 'All resources restored + Heroic Inspiration');
        }

        // Spell Database
        const spells = {
            "mending": { name:"Mending", level:"Cantrip", school:"Transmutation", type:"cantrip",
                castingTime:"1 Minute", range:"Touch", components:"V, S, M (two lodestones)", duration:"Instantaneous",
                description:`<p>This spell repairs a single break or tear in an object you touch, such as a broken chain link, two halves of a broken key, a torn cloak, or a leaking wineskin. As long as the break or tear is no larger than 1 foot in any dimension, you mend it, leaving no trace of the former damage.</p><p>This spell can physically repair a magic item or Construct, but can't restore magic to such an object.</p>` },
            "shocking-grasp": { name:"Shocking Grasp", level:"Cantrip", school:"Evocation", type:"cantrip",
                castingTime:"Action", range:"Touch", components:"V, S", duration:"Instantaneous",
                description:`<p>You extend your hand and deliver a shock of lightning to a creature you try to touch. Make a melee spell attack against the target. You have Advantage on the attack roll if the target is wearing armor made of metal. On a hit, the target takes 1d8 Lightning damage, and it can't make Opportunity Attacks until the start of its next turn.</p>`,
                upcast:"The damage increases by 1d8 when you reach levels 5 (2d8), 11 (3d8), and 17 (4d8)." },
            "prestidigitation": { name:"Prestidigitation", level:"Cantrip", school:"Transmutation", type:"cantrip",
                castingTime:"Action", range:"10 feet", components:"V, S", duration:"Up to 1 hour",
                description:`<p>This spell is a minor magical trick. You create one of the following effects within range:</p><p>â€¢ An instantaneous, harmless sensory effect (sparks, puff of wind, faint music, odd odor).</p><p>â€¢ Instantaneously light or snuff out a candle, torch, or small campfire.</p><p>â€¢ Instantaneously clean or soil an object no larger than 1 cubic foot.</p><p>â€¢ Chill, warm, or flavor up to 1 cubic foot of nonliving material for 1 hour.</p><p>â€¢ Make a color, small mark, or symbol appear on an object or surface for 1 hour.</p><p>â€¢ Create a nonmagical trinket or illusory image that fits in your hand, lasting until end of your next turn.</p><p>You can have up to three non-instantaneous effects active at a time.</p>` },
            "heroism": { name:"Heroism", level:"1st", school:"Enchantment", type:"subclass",
                castingTime:"Action", range:"Touch", components:"V, S", duration:"Concentration, up to 1 minute",
                description:`<p>A willing creature you touch is imbued with bravery. Until the spell ends, the creature is immune to the Frightened condition and gains Temporary Hit Points equal to your spellcasting ability modifier (+4) at the start of each of its turns.</p>`,
                upcast:"Target one additional creature for each slot level above 1." },
            "shield": { name:"Shield", level:"1st", school:"Abjuration", type:"subclass",
                castingTime:"Reaction (when hit by attack or targeted by Magic Missile)", range:"Self", components:"V, S", duration:"1 round",
                description:`<p>An invisible barrier of magical force protects you. Until the start of your next turn, you have a +5 bonus to AC, including against the triggering attack, and you take no damage from Magic Missile.</p>` },
            "cure-wounds": { name:"Cure Wounds", level:"1st", school:"Abjuration", type:"normal",
                castingTime:"Action", range:"Touch", components:"V, S", duration:"Instantaneous",
                description:`<p>A creature you touch regains a number of Hit Points equal to 2d8 + your spellcasting ability modifier (+4).</p>`,
                upcast:"Healing increases by 2d8 for each slot level above 1." },
            "disguise-self": { name:"Disguise Self", level:"1st", school:"Illusion", type:"normal",
                castingTime:"Action", range:"Self", components:"V, S", duration:"1 hour",
                description:`<p>You make yourselfâ€”including clothing, armor, weapons, and belongingsâ€”look different until the spell ends. You can seem up to 1 foot shorter or taller. You must adopt a form with the same basic limb arrangement.</p><p>Physical interaction reveals the illusion. A creature can take a Study action and succeed on an Intelligence (Investigation) check against your spell save DC to discern the disguise.</p>` },
            "faerie-fire": { name:"Faerie Fire", level:"1st", school:"Evocation", type:"normal",
                castingTime:"Action", range:"60 feet", components:"V", duration:"Concentration, up to 1 minute",
                description:`<p>Objects in a 20-foot Cube within range are outlined in blue, green, or violet light (your choice). Each creature in the Cube must succeed on a Dexterity saving throw or also be outlined. Outlined objects and creatures shed Dim Light in a 10-foot radius and can't benefit from the Invisible condition.</p>` },
            "shining-smite": { name:"Shining Smite", level:"2nd", school:"Transmutation", type:"subclass",
                castingTime:"Bonus Action (after hitting with a weapon)", range:"Self", components:"V", duration:"Concentration, up to 1 minute",
                description:`<p>The next time you hit a creature with a melee weapon attack during this spell's duration, your weapon flares with bright light, and the attack deals an extra 2d6 Radiant damage to the target. Additionally, the target sheds bright light in a 5-foot radius and dim light for an additional 5 feet. The target can't become invisible for the duration.</p><p>If the target is a fiend or undead, the extra damage increases to 3d6.</p>`,
                upcast:"The damage increases by 1d6 for each slot level above 2." },
            "warding-bond": { name:"Warding Bond", level:"2nd", school:"Abjuration", type:"subclass",
                castingTime:"Action", range:"Touch", components:"V, S, M (a pair of platinum rings worth 50+ GP each, which you and the target must wear for the duration)", duration:"1 hour",
                description:`<p>You touch a willing creature and create a mystic connection. While the target is within 60 feet of you, it gains +1 to AC and saving throws, and it has Resistance to all damage. Each time it takes damage, you take the same amount of damage.</p><p>The spell ends if you drop to 0 HP or if you and the target become separated by more than 60 feet. It also ends if you use this spell again on another creature.</p>` },
            "invisibility": { name:"Invisibility", level:"2nd", school:"Illusion", type:"normal",
                castingTime:"Action", range:"Touch", components:"V, S, M (an eyelash in gum arabic)", duration:"Concentration, up to 1 hour",
                description:`<p>A creature you touch has the Invisible condition until the spell ends. The spell ends early immediately after the target makes an attack roll, deals damage, or casts a spell.</p>`,
                upcast:"You can target one additional creature for each slot level above 2." },
            "blur": { name:"Blur", level:"2nd", school:"Illusion", type:"normal",
                castingTime:"Action", range:"Self", components:"V", duration:"Concentration, up to 1 minute",
                description:`<p>Your body becomes blurred. For the duration, any creature has Disadvantage on attack rolls against you. An attacker is immune to this effect if it perceives you with Blindsight or Truesight, or doesn't rely on sight.</p>` },
            "homunculus-servant": { name:"Homunculus Servant", level:"2nd", school:"Transmutation", type:"normal",
                castingTime:"Action", range:"Touch", components:"V, S, M (a gem worth 100+ GP, which the spell consumes)", duration:"Instantaneous",
                description:`<p>You create a Homunculus, a Tiny Construct that is your faithful companion. It appears in an unoccupied space you choose within range. The Homunculus is friendly to you and your companions, and it obeys your commands.</p><p>In combat, the Homunculus shares your initiative count, but takes its turn immediately after yours. It can move and use its reaction on its own, but the only action it takes on its turn is Dodge, unless you take a Bonus Action to command it to take another action. If you are Incapacitated, the Homunculus can take any action of its choice.</p><p>If the Mending spell is cast on it, it regains 2d6 HP. If it dies, it vanishes, leaving its heart gem behind. If you have the gem, you can cast this spell again to recreate the Homunculus.</p>` },
            "darkvision-spell": { name:"Darkvision", level:"2nd", school:"Transmutation", type:"normal",
                castingTime:"Action", range:"Touch", components:"V, S, M (a dried carrot or an agate)", duration:"8 hours",
                description:`<p>You touch a willing creature to grant it Darkvision out to a range of 150 feet for the duration.</p>` },
            "aura-of-vitality": { name:"Aura of Vitality", level:"3rd", school:"Abjuration", type:"subclass",
                castingTime:"Action", range:"Self (30-foot emanation)", components:"V", duration:"Concentration, up to 1 minute",
                description:`<p>An aura of healing energy radiates from you in a 30-foot Emanation for the duration. When you create this aura and at the start of each of your turns while it persists, you can restore 2d6 Hit Points to one creature in it (including yourself).</p>` },
            "conjure-barrage": { name:"Conjure Barrage", level:"3rd", school:"Conjuration", type:"subclass",
                castingTime:"Action", range:"Self (60-foot cone)", components:"V, S, M (a melee or ranged weapon worth 1+ CP)", duration:"Instantaneous",
                description:`<p>You brandish the weapon used to cast the spell and launch a barrage of similar spectral weapons. Each creature in a 60-foot Cone makes a Dexterity saving throw, taking 5d8 Force damage on a failed save or half on a success.</p>` },
            "fly": { name:"Fly", level:"3rd", school:"Transmutation", type:"normal",
                castingTime:"Action", range:"Touch", components:"V, S, M (a feather)", duration:"Concentration, up to 10 minutes",
                description:`<p>You touch a willing creature. The target gains a flying speed of 60 feet for the duration. When the spell ends, the target falls if still aloft unless it can stop the fall.</p>`,
                upcast:"Target one additional creature for each slot level above 3." },
            "haste": { name:"Haste", level:"3rd", school:"Transmutation", type:"normal",
                castingTime:"Action", range:"30 feet", components:"V, S, M (a shaving of licorice root)", duration:"Concentration, up to 1 minute",
                description:`<p>Choose a willing creature you can see within range. Until the spell ends, the target's speed is doubled, it gains a +2 bonus to AC, it has Advantage on Dexterity saving throws, and it gains an additional action on each of its turns. That action can be used only to take the Attack (one weapon attack only), Dash, Disengage, Hide, or Utilize action.</p><p>When the spell ends, the target can't move or take actions until after its next turn, as a wave of lethargy sweeps over it.</p>` }
        };

        function openSpellPopup(spellId) {
            const spell = spells[spellId]; if(!spell) return;
            const overlay = document.getElementById('spellOverlay');
            document.getElementById('spellHeader').className = 'spell-popup-header ' + (spell.type || '');
            document.getElementById('spellTitle').textContent = spell.name;
            document.getElementById('spellSubtitle').textContent = spell.level === 'Cantrip' ? spell.school+' Cantrip' : 'Level '+spell.level+' '+spell.school;
            document.getElementById('spellMeta').innerHTML = `
                <div class="spell-meta-item"><span class="spell-meta-label">Casting Time:</span> ${spell.castingTime}</div>
                <div class="spell-meta-item"><span class="spell-meta-label">Range:</span> ${spell.range}</div>
                <div class="spell-meta-item"><span class="spell-meta-label">Components:</span> ${spell.components}</div>
                <div class="spell-meta-item"><span class="spell-meta-label">Duration:</span> ${spell.duration}</div>`;
            document.getElementById('spellDescription').innerHTML = spell.description;
            const upcast = document.getElementById('spellUpcast');
            if(spell.upcast) { upcast.innerHTML = '<strong>Higher-Level Slot:</strong> '+spell.upcast; upcast.style.display='block'; }
            else { upcast.style.display='none'; }
            overlay.classList.add('active');
        }
        function closeSpellPopup() { document.getElementById('spellOverlay').classList.remove('active'); }
        document.getElementById('spellOverlay').addEventListener('click', function(e) { if(e.target===this) closeSpellPopup(); });
        document.addEventListener('keydown', function(e) { if(e.key==='Escape') closeSpellPopup(); });
        document.querySelectorAll('.spell-link').forEach(link => { link.addEventListener('click', function() { openSpellPopup(this.dataset.spell); }); });

        // Dice rolling
        let diceToastTimeout = null;
        function rollD20() { return Math.floor(Math.random()*20)+1; }
        function hideDiceToast() { const t=document.getElementById('diceToast'); t.classList.remove('show'); if(diceToastTimeout){clearTimeout(diceToastTimeout);diceToastTimeout=null;} }

        function showDiceRoll(skillName, bonus) {
            const roll=rollD20(), total=roll+bonus;
            const toast=document.getElementById('diceToast');
            document.getElementById('diceSkill').textContent=skillName;
            document.getElementById('diceResult').textContent=total;
            document.getElementById('diceBreakdown').textContent='ðŸŽ² '+roll+' '+(bonus>=0?'+':'')+bonus;
            toast.classList.remove('crit','fail');
            const label=document.getElementById('diceLabel');
            if(roll===20){toast.classList.add('crit');label.textContent='Â¡Natural 20!';}
            else if(roll===1){toast.classList.add('fail');label.textContent='Natural 1...';}
            else{label.textContent='';}
            if(diceToastTimeout) clearTimeout(diceToastTimeout);
            toast.classList.add('show');
            diceToastTimeout=setTimeout(()=>toast.classList.remove('show'),2000);
        }

        function rollAttack(name, hitBonus, diceStr, dmgBonus, dmgType) {
            const roll=rollD20(), total=roll+hitBonus;
            const toast=document.getElementById('diceToast');
            document.getElementById('diceSkill').textContent=name;
            document.getElementById('diceResult').textContent=total;
            toast.classList.remove('crit','fail');
            const label=document.getElementById('diceLabel');
            if(roll===20){toast.classList.add('crit');label.textContent='Â¡CRITICAL HIT!';
                document.getElementById('diceBreakdown').textContent='ðŸŽ² '+roll+' +'+hitBonus+' | Dmg: 2Ã—'+diceStr+' +'+dmgBonus+' '+dmgType;
            } else if(roll===1){toast.classList.add('fail');label.textContent='Critical Miss...';
                document.getElementById('diceBreakdown').textContent='ðŸŽ² '+roll+' +'+hitBonus;
            } else {label.textContent='';
                document.getElementById('diceBreakdown').textContent='ðŸŽ² '+roll+' +'+hitBonus+' | Dmg: '+diceStr+' +'+dmgBonus+' '+dmgType;
            }
            if(diceToastTimeout) clearTimeout(diceToastTimeout);
            toast.classList.add('show');
            diceToastTimeout=setTimeout(()=>toast.classList.remove('show'),2500);
        }

        document.addEventListener('click', function(e) {
            const toast=document.getElementById('diceToast');
            if(toast.classList.contains('show') && !e.target.closest('.skill-item') && !e.target.closest('.ability-save') && !e.target.closest('.initiative-roll') && !e.target.closest('.spell-stat') && !e.target.closest('.attack-item')) { hideDiceToast(); }
        });
        document.querySelectorAll('.skill-item').forEach(item => { item.addEventListener('click', function() { showDiceRoll(this.dataset.skill, parseInt(this.dataset.bonus)); }); });
        document.querySelectorAll('.ability-save').forEach(item => { item.addEventListener('click', function(e) { e.stopPropagation(); showDiceRoll(this.dataset.save+' Save', parseInt(this.dataset.bonus)); }); });
        document.querySelector('.initiative-roll').addEventListener('click', function(e) { e.stopPropagation(); showDiceRoll('Initiative', parseInt(this.dataset.bonus)); });

        function showRestToast(title, message) {
            const toast=document.getElementById('diceToast');
            document.getElementById('diceSkill').textContent=title;
            document.getElementById('diceResult').textContent='âœ“';
            document.getElementById('diceBreakdown').textContent=message;
            document.getElementById('diceLabel').textContent='';
            toast.classList.remove('crit','fail'); toast.classList.add('show');
            if(diceToastTimeout) clearTimeout(diceToastTimeout);
            diceToastTimeout=setTimeout(()=>toast.classList.remove('show'),2000);
        }
    </script>
</body>
</html>
